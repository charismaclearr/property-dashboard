<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Property Dashboard</title>
  <style>
    /* Basic styles for autocomplete */
    #address-input {
      width: 300px;
      padding: 8px;
      font-size: 16px;
    }
    #suggestions {
      border: 1px solid #ccc;
      max-height: 150px;
      overflow-y: auto;
      width: 300px;
      position: absolute;
      background: white;
      z-index: 1000;
    }
    .suggestion-item {
      padding: 8px;
      cursor: pointer;
    }
    .suggestion-item:hover {
      background-color: #eee;
    }
  </style>
</head>
<body>
  <h2>Enter Address</h2>
  <input type="text" id="address-input" placeholder="Start typing address..." autocomplete="off" />
  <div id="suggestions"></div>

  <div id="tableauViz" style="margin-top: 30px;"></div>

  <script src="https://prod-apsoutheast-a.online.tableau.com/javascripts/api/tableau.embedding.3.latest.min.js'></script><tableau-viz id='tableau-viz' src='https://prod-apsoutheast-a.online.tableau.com/t/clearrtableau/views/AddressDashboard/MapDashboard?:embed=y&:showVizHome=no' width='1000' height='840' hide-tabs toolbar='bottom' ></tableau-viz>"></script>
  <script>
    let addresses = [];
    const input = document.getElementById('address-input');
    const suggestionsContainer = document.getElementById('suggestions');
    let viz;

    // Load addresses JSON
    fetch('addresses.json')
      .then(response => response.json())
      .then(data => {
        addresses = data;
      })
      .catch(error => {
        console.error('Error loading addresses.json:', error);
      });

    // Show suggestions matching input
    input.addEventListener('input', () => {
      const query = input.value.trim().toLowerCase();
      suggestionsContainer.innerHTML = '';
      if (query.length === 0) return;

      const matches = addresses.filter(addr => addr.toLowerCase().includes(query.toLowerCase()));

      matches.forEach(match => {
        const div = document.createElement('div');
        div.textContent = match;
        div.classList.add('suggestion-item');
        div.addEventListener('click', () => {
          input.value = match;
          suggestionsContainer.innerHTML = '';
          loadTableauDashboard(match);
        });
        suggestionsContainer.appendChild(div);
      });
    });

    // Hide suggestions if clicked outside
    document.addEventListener('click', (event) => {
      if (event.target !== input) {
        suggestionsContainer.innerHTML = '';
      }
    });

    function loadTableauDashboard(address) {
      // Remove existing viz if present
      if (viz) {
        viz.dispose();
      }

      // Replace with your Tableau viz URL
      const placeholderUrl = "https://public.tableau.com/views/YourDashboardName/YourViewName";

      const options = {
        hideTabs: true,
        width: "800px",
        height: "700px",
        onFirstInteractive: function () {
          console.log("Tableau Viz Loaded");
        }
      };

      viz = new tableau.Viz(document.getElementById('tableauViz'), placeholderUrl, options);

      // Wait a bit then apply the filter
      viz.addEventListener(tableau.TableauEventName.FIRST_INTERACTIVE, () => {
        const workbook = viz.getWorkbook();
        const activeSheet = workbook.getActiveSheet();

        if (activeSheet.getSheetType() === 'dashboard') {
          // Assuming your dashboard filter is named 'FullAddress'
          activeSheet.applyFilterAsync('FullAddress', address, tableau.FilterUpdateType.REPLACE);
        } else {
          console.warn('Active sheet is not a dashboard, filter not applied.');
        }
      });
    }
  </script>
</body>
</html>
