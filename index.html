<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Property Dashboard</title>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #addressInput { width: 300px; padding: 8px; font-size: 16px; }
    #vizContainer { margin-top: 30px; }
    tableau-viz, iframe { width: 1000px; height: 840px; display: block; }
  </style>
</head>
<body>
  <h2>Enter an Address</h2>
  <input type="text" id="addressInput" placeholder="Start typing an address..." />
  <div id="vizContainer"></div>

  <!-- jQuery and jQuery UI -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <!-- Tableau Embedding API v3 for tableau-viz web component -->
  <script src="https://embedding.tableauusercontent.com/tableau.embedding.3.latest.js"></script>

  <script>
    const vizContainer = document.getElementById('vizContainer');
    fetch('https://charismaclearr.github.io/property-dashboard/addresses.json')
      .then(res => res.json())
      .then(addresses => {
        $('#addressInput').autocomplete({
          source: addresses,
          select: function(event, ui) {
            const selectedAddress = ui.item.value;
            loadTableauDashboard(selectedAddress);
            loadTableauIframe(selectedAddress); // For troubleshooting
          }
        });
      })
      .catch(err => {
        console.error('Failed to load addresses.json:', err);
      });

    function loadTableauDashboard(address) {
      vizContainer.innerHTML = '';
      // Tableau Public parameter names are case- and space-sensitive
      const baseUrl = "https://public.tableau.com/views/AddressDashboard_17479873620460/MapDashboard";
      // Use the correct parameter name as defined in your Tableau Public dashboard
      const paramStr = `?:embed=y&:showVizHome=no&FullAddress%20Parameter=${encodeURIComponent(address)}`;
      const tableauViz = document.createElement('tableau-viz');
      tableauViz.id = 'tableau-viz';
      tableauViz.src = baseUrl + paramStr;
      tableauViz.setAttribute('width', '1000');
      tableauViz.setAttribute('height', '840');
      tableauViz.setAttribute('hide-tabs', '');
      tableauViz.setAttribute('toolbar', 'bottom');
      vizContainer.appendChild(tableauViz);
    }

    // For troubleshooting: show the iframe as well
    function loadTableauIframe(address) {
      const baseUrl = "https://public.tableau.com/views/AddressDashboard_17479873620460/MapDashboard";
      const paramStr = `?:embed=y&:showVizHome=no&FullAddress%20Parameter=${encodeURIComponent(address)}`;
      const iframe = document.createElement('iframe');
      iframe.src = baseUrl + paramStr;
      iframe.width = "1000";
      iframe.height = "840";
      iframe.style.display = "block";
      iframe.style.marginTop = "20px";
      vizContainer.appendChild(iframe);
    }
  </script>
</body>
</html>
