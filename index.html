<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Property Dashboard</title>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #addressInput { width: 300px; padding: 8px; font-size: 16px; }
    #vizContainer { margin-top: 30px; }
    .tableauPlaceholder { width: 1000px; height: 827px; }
  </style>
</head>
<body>
  <h2>Enter an Address</h2>
  <input type="text" id="addressInput" placeholder="Start typing an address..." />
  <div id="vizContainer"></div>

  <!-- jQuery and jQuery UI -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <script>
    const tableauDivId = 'viz1747987821406';
    const baseName = 'AddressDashboard_17479873620460/MapDashboard';
    const tableauHost = 'https%3A%2F%2Fpublic.tableau.com%2F';
    const staticImg = 'https://public.tableau.com/static/images/Ad/AddressDashboard_17479873620460/MapDashboard/1.png';
    const staticImgRss = 'https://public.tableau.com/static/images/Ad/AddressDashboard_17479873620460/MapDashboard/1_rss.png';

    const vizContainer = document.getElementById('vizContainer');

    // Load addresses for autocomplete
    fetch('https://charismaclearr.github.io/property-dashboard/addresses.json')
      .then(res => res.json())
      .then(addresses => {
        $('#addressInput').autocomplete({
          source: addresses,
          select: function(event, ui) {
            const selectedAddress = ui.item.value;
            loadTableauDashboard(selectedAddress);
          }
        });
      })
      .catch(err => {
        console.error('Failed to load addresses.json:', err);
      });

    function loadTableauDashboard(address) {
      vizContainer.innerHTML = '';
      // URL encode parameter name and value
      const paramName = 'FullAddress%20Parameter';
      const paramValue = encodeURIComponent(address);
      const nameParam = `${baseName}?:embed=y&${paramName}=${paramValue}`;

      // Build embed HTML WITHOUT the <script> tag
      const embedHtml = `
        <div class='tableauPlaceholder' id='${tableauDivId}' style='position: relative'>
          <noscript>
            <a href='#'>
              <img alt='Map Dashboard ' src='${staticImgRss}' style='border: none' />
            </a>
          </noscript>
          <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='${tableauHost}' />
            <param name='embed_code_version' value='3' />
            <param name='site_root' value='' />
            <param name='name' value='${nameParam}' />
            <param name='tabs' value='no' />
            <param name='toolbar' value='yes' />
            <param name='static_image' value='${staticImg}' />
            <param name='animate_transition' value='yes' />
            <param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' />
            <param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' />
            <param name='language' value='en-US' />
            <param name='filter' value='publish=yes' />
          </object>
        </div>
      `;
      vizContainer.innerHTML = embedHtml;

      // Now dynamically add the Tableau loader script
      var divElement = document.getElementById(tableauDivId);
      var vizElement = divElement.getElementsByTagName('object')[0];
      if (divElement.offsetWidth > 800) {
        vizElement.style.width='1000px';vizElement.style.height='827px';
      } else if (divElement.offsetWidth > 500) {
        vizElement.style.width='1000px';vizElement.style.height='827px';
      } else {
        vizElement.style.width='100%';vizElement.style.height='727px';
      }
      var scriptElement = document.createElement('script');
      scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
      vizElement.parentNode.insertBefore(scriptElement, vizElement);
    }
  </script>
</body>
</html>
